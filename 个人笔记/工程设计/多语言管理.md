# 多语言管理

问题：多个字符串池如何合并
*暂时不考虑图片以及音效等*

## 现有的字符串池

* UI字符串
* 代码中的字符串
* 表格中的字符串
* 剧本中的字符串

## 目标

* 去冗余
* 可热更
* 增量式添加字段
* 策划无感知

## 初步设计

自增id为key，公用一个字符串池。

以下是操作方案：

* UI字符串添加扫描工具，Text以及TMP思考无感知本地化方法。
* 代码中的字符串沿用原来的方式进行记录，id需要改为自增
* 剧本改为编译式，使用二进制而非使用字符串记录，命令将记录id，参数添加本地化参数，编译时只抽出需要本地化的参数。
* 表格已有字符串数组改为记录id，bytes数组进一步缩小了。

## 检查目标

* 去冗余：由于是单个字符串池，所以已达成
* 可热更：由于是自增增量式，所以支持热更新字段
* 增量式添加字段：自增id，当添加新字符串都将加到最后
* 策划无感知：剧本在编译时抽出，表格在导出时抽出，代码需要程序自行处理，UI通过工具扫描，对于策划而言都是无感知的。达成

## 存在问题

### 问题：
id为key将存在冲突问题，在多人编辑下自增key将导致一方需要重新生成key。
### 解决方案：
所以将直接采用字符串作为key，中文作为key。

*添加新目标：方便合并*

### 问题：
但是中文作为key存在长字符串大量废弃的情况，翻译将面临冗余工作。去冗余目标无法达成。
剧本大部分为长字符串，其他则都为长短混合型
### 解决方案：
分为3种类型的表：
1. 复用表
2. 长字符串表
3. 长字符串翻译表

当字符串（value）长度小于n则使用复用表，否则采用长字符串表。

短字符串查看在复用表中是否存在，如果存在则采用复用表id，否则插入。
长字符串查找长字符串翻译表，如果存在则采用长字符串翻译表id，否则插入。并且每个翻译单元生成单个长字符串表用于后期合并。

提供给翻译的将是将各个长字符串表以及复用表的并集，其中长字符串新翻译部分加入长字符串表。

在打包时将复用表以及所有长字符串表合并为一个大的Localization表。

### 问题：
分字符串表之后的key冲突问题
### 解决方案：
当复用表与长字符串表若存在冲突则在打包的时候产生报错。



